name: Carmel Judgment Protocol ğŸ˜¼

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  judgment:
    name: Carmel Reviews the Offering
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§¾ Checkout code
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: ğŸ“¦ Install dependencies
        run: npm ci

      - name: ğŸ§ª Run tests
        id: tests
        run: npm run test:run

      - name: ğŸ˜¼ Carmel Judgment Stamp
        if: always()
        uses: actions/github-script@v7
        with:
          script: |
            const passed = ${{ steps.tests.outcome === 'success' }};
            const body = passed
              ? "ğŸ˜¼âœ¨ **Carmel Approval Stampâ„¢**\n\n> *Adequate work, human.*"
              : "ğŸ˜¼ğŸ”¥ **Carmel Chaos Stampâ„¢**\n\n> *I sense weakness in these tests.*";

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body
            });

            if (!passed) {
              core.setFailed("Carmel has rejected this PR.");
            }

      - name: ğŸ˜¼ Carmel Observes the Results
        run: echo "Verdict delivered."
